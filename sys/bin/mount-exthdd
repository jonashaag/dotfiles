#!/bin/sh

ensure_dollar_1() {
    if [ -z "$1" ]
    then
        echo "USAGE: $0 device"
        exit 1
    fi
}

if [ -z "$(mount|grep exthdd)" ]
then
    ensure_dollar_1 $@
    sudo cryptsetup luksOpen $1 exthdd
    sudo mkdir /media/exthdd
    sudo chown jonas:users /media/exthdd
    sudo mount /dev/mapper/exthdd /media/exthdd
else
    if [ "$2" = "-u" ]
    then
        sudo umount /media/exthdd
        sudo cryptsetup luksClose exthdd
        sudo rmdir /media/exthdd
    fi
fi
